{"version":3,"sources":["../../server-src/middlewares/koa2-webpack-dev-middleware.js"],"names":[],"mappings":"0WAAA,IAAI,oBAAoB,QAAQ,wBAAR,CAAxB;;AAEA,SAAS,UAAT,CAAoB,IAApB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC;AAClC,MAAI,cAAc,IAAI,GAAtB;;AAEA,SAAO,UAAU,IAAV,EAAgB;AACrB,QAAI,GAAJ,GAAU,YAAY;AACpB,kBAAY,KAAZ,CAAkB,IAAlB,EAAwB,SAAxB;AACA,WAAK,IAAL,EAAW,CAAX;AACD,KAHD;AAIA,SAAK,GAAL,EAAU,GAAV,EAAe,YAAY;AACzB,WAAK,IAAL,EAAW,CAAX;AACD,KAFD;AAGD,GARD;AASD;;AAED,OAAO,OAAP,GAAiB,UAAU,QAAV,EAAoB,MAApB,EAA4B;AAC3C,MAAI,OAAO,kBAAkB,QAAlB,EAA4B,MAA5B,CAAX;AACA,4FAAO,iBAAgB,GAAhB,EAAqB,IAArB;AACD,iBADC,GACK,IADL;AAED,iBAFC,GAEK,KAAK,GAFV;AAGe,2BAAW,IAAX,EAAiB,GAAjB,EAAsB;AACxC,uBAAK,aAAU,OAAV,EAAmB;AACtB,wBAAI,IAAJ,GAAW,OAAX;AACD,mBAHuC;AAIxC,6BAAW,qBAAY;AACrB,wBAAI,GAAJ,CAAQ,KAAR,CAAc,GAAd,EAAmB,SAAnB;AACD,mBANuC,EAAtB,CAHf,SAGD,OAHC;;AAWD,qBAXC;AAYG,sBAZH,gEAAP;;;AAeD,CAjBD","file":"koa2-webpack-dev-middleware.js","sourcesContent":["var expressMiddleware = require('webpack-dev-middleware')\n\nfunction middleware(doIt, req, res) {\n  var originalEnd = res.end;\n\n  return function (done) {\n    res.end = function () {\n      originalEnd.apply(this, arguments);\n      done(null, 0);\n    };\n    doIt(req, res, function () {\n      done(null, 1);\n    })\n  }\n}\n\nmodule.exports = function (compiler, option) {\n  var doIt = expressMiddleware(compiler, option);\n  return async function (ctx, next) {\n    var ctx = this;\n    var req = this.req;\n    var runNext = await middleware(doIt, req, {\n      end: function (content) {\n        ctx.body = content;\n      },\n      setHeader: function () {\n        ctx.set.apply(ctx, arguments);\n      }\n    });\n    if (runNext) {\n      await next();\n    }\n  };\n};"]}